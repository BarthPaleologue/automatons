(()=>{"use strict";var t,o=function(){function t(t,o){this.x=t,this.y=o}return t.prototype.add=function(o){return new t(this.x+o.x,this.y+o.y)},t.prototype.addInPlace=function(t){this.x+=t.x,this.y+=t.y},t.prototype.subtract=function(o){return new t(this.x-o.x,this.y-o.y)},t.prototype.divide=function(o){return new t(this.x/o,this.y/o)},t.prototype.divideInPlace=function(t){this.x/=t,this.y/=t},t.prototype.scale=function(o){return new t(this.x*o,this.y*o)},t.prototype.scaleInPlace=function(t){this.x*=t,this.y*=t},t.prototype.squaredMagnitude=function(){return Math.pow(this.x,2)+Math.pow(this.y,2)},t.prototype.magnitude=function(){return Math.sqrt(this.squaredMagnitude())},t.prototype.normalize=function(){return this.divide(this.magnitude())},t.prototype.normalizeInPlace=function(){this.divideInPlace(this.magnitude())},t.random=function(o){void 0===o&&(o=1);var i=new t(Math.random()-.5,Math.random()-.5);return i.normalizeInPlace(),i.scaleInPlace(o),i},t.distance=function(t,o){return o.subtract(t).magnitude()},t.distanceSquared=function(t,o){return o.subtract(t).squaredMagnitude()},t.dot=function(t,o){return t.x*o.x+t.y*o.y},t}(),i=function(){function t(t,o,i,e){this.position=t,this.theta=o,this.scale=i,this.color="white",this.context=e}return t.prototype.draw=function(){},t.prototype.move=function(t){this.position.addInPlace(t)},t.prototype.getForwardVector=function(){return new o(Math.cos(this.theta),Math.sin(this.theta))},t.prototype.moveForward=function(t){this.move(this.getForwardVector().scale(t))},t.prototype.rotateRad=function(t){this.theta+=t},t.prototype.setColor=function(t){this.color=t},t}(),e=(t=function(o,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i])},t(o,i)},function(o,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function e(){this.constructor=o}t(o,i),o.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}),n=function(t){function o(o,i,e,n){return t.call(this,o,i,e,n)||this}return e(o,t),o.prototype.draw=function(){this.context.translate(this.position.x,this.position.y),this.context.rotate(this.theta),this.context.fillStyle=this.color,this.context.moveTo(-this.scale/2,-this.scale/2),this.context.lineTo(-this.scale/2,this.scale/2),this.context.lineTo(this.scale,0),this.context.lineTo(-this.scale/2,-this.scale/2),this.context.rotate(-this.theta),this.context.translate(-this.position.x,-this.position.y)},o}(i),a=function(){var t=function(o,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i])},t(o,i)};return function(o,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function e(){this.constructor=o}t(o,i),o.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}}(),s=function(t){function o(o,i,e,n,a){var s=t.call(this,o,i,e,a)||this;return s.aperture=n,s}return a(o,t),o.prototype.draw=function(){this.context.translate(this.position.x,this.position.y),this.context.rotate(this.theta),this.context.moveTo(0,0),this.context.arc(0,0,this.scale,-this.aperture/2,this.aperture/2),this.context.lineTo(0,0),this.context.rotate(-this.theta),this.context.translate(-this.position.x,-this.position.y)},o}(i),r=function(){function t(t,i,e,a,r,c){this.velocity=new o(Math.random()-.5,Math.random()-.5).scale(100),this.isHitboxDisplayed=!1,this.shape=new n(t,i,e,c),this.hitbox=new s(t,i,a,r,c),this.hitbox.setColor("rgba(255, 255, 255, 0.05)"),this.hitboxRadius=a,this.fov=r}return t.prototype.getForwardDirection=function(){return this.shape.getForwardVector()},t.prototype.draw=function(){this.isHitboxDisplayed&&this.hitbox.draw(),this.shape.draw()},t.prototype.move=function(){this.shape.position.addInPlace(this.velocity),this.shape.theta=Math.atan2(this.velocity.y,this.velocity.x),this.hitbox.position=this.shape.position,this.hitbox.theta=this.shape.theta},t.prototype.update=function(t,i,e){var n=[],a=new o(0,0),s=new o(0,0),r=new o(0,0),c=new o(0,0);c.x-=1/(this.shape.position.x+1),c.y-=1/(this.shape.position.y+1),c.x+=1/(i-this.shape.position.x+1),c.y+=1/(e-this.shape.position.y+1);for(var h=0,l=t;h<l.length;h++){var p=l[h];if(p!=this){var u=o.distanceSquared(this.shape.position,p.shape.position),d=p.shape.position.subtract(this.shape.position).divide(u),y=Math.abs(Math.atan2(d.y,d.x)-Math.atan2(this.getForwardDirection().y,this.getForwardDirection().x));u<Math.pow(this.hitbox.scale,2)&&y<this.hitbox.aperture/2&&(n.push(p),a.addInPlace(this.shape.position.subtract(p.shape.position)),r.addInPlace(p.shape.position),s.addInPlace(p.velocity))}}if(n.length>0){var f=s.divide(n.length),v=a.divide(n.length).normalize(),x=r.divide(n.length).subtract(this.shape.position).normalize();this.velocity.normalizeInPlace(),this.velocity.scaleInPlace(83),this.velocity.addInPlace(f.scale(5)),this.velocity.addInPlace(x.scale(40)),this.velocity.addInPlace(v.scale(55)),this.velocity.normalizeInPlace(),this.velocity.scaleInPlace(4),this.velocity.magnitude()>2&&(this.velocity.normalizeInPlace(),this.velocity.scaleInPlace(2))}this.velocity.addInPlace(c.scale(-10)),this.move()},t}(),c=document.getElementById("renderer"),h=window.innerWidth,l=window.innerHeight;c.width=h,c.height=l;for(var p=c.getContext("2d",{alpha:!1}),u=[],d=2*Math.PI/4,y=0;y<1e3;y++){var f=new r(new o(Math.random()*h,Math.random()*l),6.28*Math.random(),10,40,d,p);f.shape.setColor("#".concat(Math.floor(16777215*Math.random()).toString(16)));var v=2*Math.random()*Math.PI;f.velocity=new o(Math.cos(v),Math.sin(v)).scale(100),u.push(f)}var x={};document.addEventListener("keydown",(function(t){if(x[t.key]=!0,"h"==t.key)for(var o=0,i=u;o<i.length;o++){var e=i[o];e.isHitboxDisplayed=!e.isHitboxDisplayed}})),document.addEventListener("keyup",(function(t){x[t.key]=!1})),requestAnimationFrame((function t(){p.fillStyle="black",null==p||p.fillRect(0,0,h,l);for(var o={},i=0,e=u;i<e.length;i++){var n=e[i],a=Math.floor(n.shape.position.x/20),s=Math.floor(n.shape.position.y/10);null==o["".concat(a,";").concat(s)]?o["".concat(a,";").concat(s)]=[n]:o["".concat(a,";").concat(s)].push(n)}for(var r=0,c=u;r<c.length;r++){n=c[r],a=Math.floor(n.shape.position.x/20),s=Math.floor(n.shape.position.y/10);var d=(o["".concat(a,";").concat(s)]||[]).concat(o["".concat(a-1,";").concat(s-1)]||[],o["".concat(a-1,";").concat(s)]||[],o["".concat(a-1,";").concat(s+1)]||[],o["".concat(a,";").concat(s-1)]||[],o["".concat(a,";").concat(s+1)]||[],o["".concat(a+1,";").concat(s-1)]||[],o["".concat(a+1,";").concat(s)]||[],o["".concat(a+1,";").concat(s+1)]||[]);n.update(d,h,l)}p.beginPath();for(var y=0,f=u;y<f.length;y++)(n=f[y]).shape.draw();p.closePath(),p.fill(),p.beginPath();for(var v=0,w=u;v<w.length;v++)(n=w[v]).isHitboxDisplayed&&n.hitbox.draw();p.closePath(),p.fillStyle="rgba(255,255,255,0.1)",p.fill(),function(){if(x["-"])for(var t=0,o=u;t<o.length;t++)o[t].hitbox.aperture-=.05;if(x["+"])for(var i=0,e=u;i<e.length;i++)e[i].hitbox.aperture+=.05}(),requestAnimationFrame(t)}))})();