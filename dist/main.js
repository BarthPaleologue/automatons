(()=>{"use strict";var t={514:(t,i)=>{i.aI=void 0,i.aI=function(t,i,e){return void 0===t&&(t=0),void 0===i&&(i=1),void 0===e&&(e=Math.random),e()*(i-t)+t}}},i={};function e(s){var o=i[s];if(void 0!==o)return o.exports;var a=i[s]={exports:{}};return t[s](a,a.exports,e),a.exports}(()=>{class t{constructor(t,i){this.x=t,this.y=i}add(i){return new t(this.x+i.x,this.y+i.y)}addInPlace(t){this.x+=t.x,this.y+=t.y}subtract(i){return new t(this.x-i.x,this.y-i.y)}divide(i){return new t(this.x/i,this.y/i)}divideInPlace(t){this.x/=t,this.y/=t}scale(i){return new t(this.x*i,this.y*i)}scaleInPlace(t){this.x*=t,this.y*=t}squaredMagnitude(){return Math.pow(this.x,2)+Math.pow(this.y,2)}magnitude(){return Math.sqrt(this.squaredMagnitude())}normalize(){return this.divide(this.magnitude())}normalizeInPlace(){this.divideInPlace(this.magnitude())}static random(i=1){let e=new t(Math.random()-.5,Math.random()-.5);return e.normalizeInPlace(),e.scaleInPlace(i),e}static distance(t,i){return i.subtract(t).magnitude()}static distanceSquared(t,i){return i.subtract(t).squaredMagnitude()}static dot(t,i){return t.x*i.x+t.y*i.y}}class i{constructor(t,i,e,s){this.position=t,this.theta=i,this.scale=e,this.color="white",this.context=s}draw(){}move(t){this.position.addInPlace(t)}getForwardVector(){return new t(Math.cos(this.theta),Math.sin(this.theta))}moveForward(t){this.move(this.getForwardVector().scale(t))}rotateRad(t){this.theta+=t}setColor(t){this.color=t}}class s extends i{constructor(t,i,e,s){super(t,i,e,s)}draw(){this.context.translate(this.position.x,this.position.y),this.context.rotate(this.theta),this.context.fillStyle=this.color,this.context.moveTo(-this.scale/2,-this.scale/2),this.context.lineTo(-this.scale/2,this.scale/2),this.context.lineTo(this.scale,0),this.context.lineTo(-this.scale/2,-this.scale/2),this.context.rotate(-this.theta),this.context.translate(-this.position.x,-this.position.y)}}class o extends i{constructor(t,i,e,s,o){super(t,i,e,o),this.aperture=s}draw(){this.context.translate(this.position.x,this.position.y),this.context.rotate(this.theta),this.context.moveTo(0,0),this.context.arc(0,0,this.scale,-this.aperture/2,this.aperture/2),this.context.lineTo(0,0),this.context.rotate(-this.theta),this.context.translate(-this.position.x,-this.position.y)}}class a{constructor(i,e,a,n,h,r){this.velocity=new t(Math.random()-.5,Math.random()-.5).scale(100),this.isHitboxDisplayed=!1,this.shape=new s(i,e,a,r),this.hitbox=new o(i,e,n,h,r),this.hitbox.setColor("rgba(255, 255, 255, 0.05)"),this.hitboxRadius=n,this.fov=h}getForwardDirection(){return this.shape.getForwardVector()}getPosition(){return this.shape.position}draw(){this.isHitboxDisplayed&&this.hitbox.draw(),this.shape.draw()}move(){this.shape.position.addInPlace(this.velocity),this.shape.theta=Math.atan2(this.velocity.y,this.velocity.x),this.hitbox.position=this.shape.position,this.hitbox.theta=this.shape.theta}update(i,e,s){let o=[],a=new t(0,0),n=new t(0,0),h=new t(0,0),r=new t(0,0);r.x-=1/(this.getPosition().x+1),r.y-=1/(this.getPosition().y+1),r.x+=1/(e-this.getPosition().x+1),r.y+=1/(s-this.getPosition().y+1);let l=new t(0,0),c=0;for(let e of i){if(e==this)continue;let i=t.distance(this.getPosition(),e.getPosition());if(e.getPosition().subtract(this.getPosition()).divide(i),i>0&&i<this.hitboxRadius){let t=this.getPosition().subtract(e.getPosition());t.normalizeInPlace(),t.divideInPlace(i),l.addInPlace(t),c++}const s=3;i>0&&i<this.hitboxRadius*s&&(o.push(e),a.addInPlace(this.getPosition().subtract(e.getPosition())),h.addInPlace(e.getPosition()),n.addInPlace(e.velocity))}c>0&&l.divideInPlace(c),l.squaredMagnitude()>0&&(l.normalizeInPlace(),l.scaleInPlace(2),l.subtract(this.velocity),l.magnitude()>.15&&(l.normalizeInPlace(),l.scaleInPlace(.15)));let d=new t(0,0);n.squaredMagnitude()>0&&(n.normalizeInPlace(),n.scaleInPlace(2),d=n.subtract(this.velocity),d.magnitude()>.05&&(d.normalizeInPlace(),d.scaleInPlace(.05))),o.length>0&&(n.divide(o.length),h.divide(o.length).subtract(this.shape.position).normalize(),this.velocity.normalizeInPlace(),this.velocity.scaleInPlace(83),this.velocity.normalizeInPlace(),this.velocity.scaleInPlace(4),this.velocity.magnitude()>2&&(this.velocity.normalizeInPlace(),this.velocity.scaleInPlace(2))),this.velocity.addInPlace(l),this.velocity.addInPlace(d),this.velocity.addInPlace(r.scale(-10)),this.move()}}var n=e(514);const h=document.getElementById("renderer"),r=window.innerWidth,l=window.innerHeight;h.width=r,h.height=l;const c=h.getContext("2d",{alpha:!1}),d={},u=[],x=2*Math.PI/4;for(let i=0;i<300;i++){let i=new a(new t((0,n.aI)(r/3,2*r/3),(0,n.aI)(l/3,2*l/3)),6.28*Math.random(),10,40,x,c);i.shape.setColor(`#${Math.floor(16777215*Math.random()).toString(16)}`);let e=2*Math.random()*Math.PI;i.velocity=new t(Math.cos(e),Math.sin(e)),u.push(i)}document.addEventListener("keydown",(t=>{if(d[t.key]=!0,"h"==t.key)for(let t of u)t.isHitboxDisplayed=!t.isHitboxDisplayed})),document.addEventListener("keyup",(t=>d[t.key]=!1)),requestAnimationFrame((function t(){const i=new Array(5);for(let t=0;t<5;t++){i[t]=new Array(4);for(let e=0;e<4;e++)i[t][e]=[]}for(const t of u){const e=Math.floor(5*t.shape.position.x/r),s=Math.floor(4*t.shape.position.y/l);if(e<0||e>=5)throw new Error("X coord out of bound");if(s<0||s>=4)throw new Error("Y coord out of bound");i[e][s].push(t)}for(const t of u)Math.floor(5*t.shape.position.x/r),Math.floor(4*t.shape.position.y/l),t.update(u,r,l);c.fillStyle="black",c.fillRect(0,0,r,l),c.beginPath();for(let t of u)t.shape.draw();c.closePath(),c.fill(),c.beginPath();for(let t of u)t.isHitboxDisplayed&&t.hitbox.draw();c.closePath(),c.fillStyle="rgba(255,255,255,0.1)",c.fill(),function(){if(d["-"])for(let t of u)t.hitbox.aperture-=.05;if(d["+"])for(let t of u)t.hitbox.aperture+=.05}(),requestAnimationFrame(t)}))})()})();